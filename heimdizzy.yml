# Heimdizzy deployment configuration for Curupira MCP Server
version: "1.0"

service:
  name: curupira-mcp-server
  type: container
  category: infrastructure

build:
  dockerfile: Dockerfile.infrastructure.deploy
  platform: x86_64
  binaryName: curupira-mcp-server
  features: ["websocket", "mcp", "chrome-integration"]
  useDocker: true
  cleanupContainer: true

deployments:
  - name: curupira-infrastructure-staging
    environment: staging
    build:
      dockerfile: Dockerfile.infrastructure.deploy
    storage:
      endpoint: "local"
      region: "local"
      bucket: "temp"
      forcePathStyle: true
      accessKeyId: "temp"
      secretAccessKey: "temp"
    deployment:
      type: container
      runtime: nodejs
      container:
        registry:
          endpoint: docker-registry.container-registry.svc.cluster.local:5000
          repository: curupira-mcp-server
          tag: latest
          insecure: true
        kubernetes:
          namespace: infrastructure
          replicas: 1
          gitOpsPath: nix/k8s/clusters/plo/infrastructure/curupira
          resources:
            requests:
              memory: "256Mi"
              cpu: "250m"
            limits:
              memory: "512Mi"
              cpu: "500m"
          ports:
            - containerPort: 8080
              name: mcp-ws
          env:
            - name: NODE_ENV
              value: "production"
            - name: CURUPIRA_TRANSPORT_WEBSOCKET
              value: "true"
            - name: CURUPIRA_TRANSPORT_HTTP
              value: "true"
            - name: CURUPIRA_LOG_LEVEL
              value: "info"
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 3
            failureThreshold: 3
          useExistingManifests: true
    notifications:
      enabled: false